纯残差式（无能量）PINN：3D 摩擦接触 + 分阶段预紧（拧紧顺序）
目标：完全舍去“总势能/能量最小化”主骨架，改用平衡方程 + 互补/摩擦约束的残差型损失构造
生成时间：2026-01-14 11:42
0. 适用范围与基本假设
本文档给出在“完全不使用能量项（E_int、W_pre、E_cn 的能量写法等）”前提下，用于 3D 准静态摩擦接触 + 螺栓分阶段预紧（包含拧紧顺序与历史效应）的 PINN 损失函数推荐构成。
核心思路：把问题视为一个变分不等式/互补系统（VI/KKT system），以残差最小二乘的方式训练网络。
典型适用条件：小变形线弹性（或弹塑性返回映射）、准静态加载（每阶段/每增量求平衡）、Coulomb 摩擦。
0.1 记号与变量
域：Ω ⊂ R^3，边界 ∂Ω = Γ_D ∪ Γ_N（位移边界/力边界）。
位移场：u(x, τ) ∈ R^3；τ 为伪时间/加载阶段参数（可离散为 stage i）。
小应变：ε(u) = 0.5(∇u + ∇u^T)。
应力：σ = C : ε（线弹性）或 σ = σ(ε, history)（弹塑性返回映射）。
接触界面：Γ_c（由 slave/master 点对与法向 n 定义）。
法向间隙（gap）：g_n(u) ≥ 0；接触压力（法向乘子）：λ_n ≥ 0。
切向牵引：λ_t ∈ R^2（在切向基 t1,t2 下），满足库仑锥 ||λ_t|| ≤ μ·λ_n。
切向相对滑移：s_t ∈ R^2；增量滑移：Δs_t = s_t^i − s_t^{i−1}（路径依赖关键）。
螺栓预紧：第 i 阶段目标预紧力 P_i（或每螺栓 P_{b,i}），顺序决定 P_i 的激活/增长。
1. 总损失函数：完全残差式（Residual-only）
在 stage i（或 τ 采样点）上，推荐的总损失写成：
L_total = w_eq·L_eq + w_const·L_const + w_bc·L_bc + w_tie·L_tie
        + w_cn·L_cn + w_ct·L_ct + w_pre·L_pre + w_reg·L_reg
        + (可选) w_sigma·L_sigma + (可选) w_aux·L_aux
其中每个 L_* 都是“残差平方的加权平均”，用于逼近平衡方程、边界条件、接触互补条件与摩擦条件。与能量法不同，这里没有 E_int 或 U−W 的势能结构。
1.1 各分项作用（概览）
分项
目标对象
典型残差
物理类型
备注/推荐
L_eq
准静态平衡
∇·σ + b = 0 或弱式内力=外力
PDE 残差
建议用弱式/离散内力形式更稳
L_const
本构一致
σ_pred − C:ε(u) = 0
约束残差
若无应力头可省略；若有则强烈建议加
L_bc
位移边界
u(x) − u_target = 0
约束残差
可 hard 投影或 soft 残差
L_tie
绑定/连续
u_s − u_m = 0
约束残差
对多部件/连接很关键
L_cn
法向接触互补
g_n ⟂ λ_n,  g_n≥0, λ_n≥0
NCP/互补
推荐用 Fischer-Burmeister 或投影残差
L_ct
切向摩擦
||λ_t||≤μλ_n 且 stick/slip
锥约束+流动律
推荐用“投影残差”或 FB-NCP
L_pre
预紧加载控制
F_bolt(u,σ) − P_target = 0
工艺/载荷残差
把“顺序/阶段”融入控制函数
L_reg
数值正则
∇u 平滑/参数范数等
正则化
抑制假振荡；避免过拟合
2. 平衡残差 L_eq（核心：准静态力平衡）
两种常用写法：强式残差与弱式（或离散）残差。工程上更推荐弱式/离散形式。
2.1 强式平衡残差（概念清晰，但数值更难）
r_eq(x) = ∇·σ(x) + b(x)   （在 Ω 内）
L_eq = E_{x∈Ω}[ || r_eq(x) ||^2 ]
强式需要二阶空间导数（σ 依赖 ε，ε 依赖 ∇u），对噪声与采样更敏感。
2.2 弱式/离散平衡残差（推荐）
在 DFEM/有限元离散语境，可用单元内力向量表示平衡。对每个子单元 m：
f_int(m) = B(m) · σ_for_B(m)         （B 为应变-力映射矩阵，σ_for_B 为与 B 顺序一致的应力向量）
r_eq(m)  = f_int(m) - f_ext(m)        （f_ext 含接触/预紧/外载投影到该子单元的等效项）
L_eq = ( Σ_m w_m · ||r_eq(m)||^2 ) / ( Σ_m w_m )
说明：如果暂不显式构造 f_ext(m)，可先令 f_ext=0，把接触与预紧通过独立残差项（L_cn/L_ct/L_pre）约束；随后再升级到“统一平衡残差”以提升一致性。
3. 本构一致残差 L_const（位移-应力一致性）
若网络输出包含应力头 σ_pred（或 traction/乘子头），建议显式加入本构一致残差：
ε(u) = 0.5(∇u + ∇u^T)
σ_phys(u) = C : ε(u)     （线弹性）
r_const = (σ_pred - σ_phys(u)) / σ_ref
L_const = E[ || r_const ||^2 ]
若采用弹塑性返回映射，σ_phys(u, history) 由“试应力—回归”得到；此时 L_const 依然成立。
若网络只输出 u 而不输出 σ，则 L_const 可省略（σ 由 u 计算），但会失去“显式应力可解释头”的优势。
4. 边界条件残差 L_bc 与 Tie 残差 L_tie
4.1 位移边界（Dirichlet）
r_bc(x) = M(x) ⊙ ( u(x) - u_target(x) ),   x ∈ Γ_D
L_bc = E_{x∈Γ_D}[ || r_bc(x) ||^2 ]
其中 M 为自由度 mask（例如只固定某些方向）。可选：对 Dirichlet 采用 hard 投影，使 r_bc 恒为 0。
4.2 Tie/绑定约束（多部件连接）
r_tie(x_s, x_m) = M ⊙ ( u(x_s) - u(x_m) )
L_tie = E[ || r_tie ||^2 ]
5. 预紧（螺栓拧紧）控制残差 L_pre（把顺序/历史融入“载荷控制”）
在残差式框架下，不再用“外功 W_pre”，而是对预紧目标施加等效控制残差。最推荐的形式是“轴向合力约束”或“轴向平均应力约束”。
5.1 轴向合力约束（推荐）
对第 b 个螺栓，其预紧等效为在某截面/端面上的轴向合力等于目标预紧力 P_b(stage)：
F_b(u,σ) = ∫_{A_b} (σ·n)·a_b dA   （a_b 为螺栓轴向单位向量；A_b 为端面/截面）
r_pre,b = (F_b(u,σ) - P_b^target(stage)) / P_ref
L_pre = E_b[ r_pre,b^2 ]
若你当前实现使用端面点云近似积分，可用加权和近似：F_b ≈ Σ_j w_j · (σ_j·n_j)·a_b。
5.2 分阶段加载与 force-then-lock（顺序历史）
把拧紧顺序 π 映射为分阶段目标 P_b^target(stage)。典型规则：
stage i: 仅激活 b = π(i) 的预紧增量；其余螺栓保持上一阶段锁定值
P_b^target(i) = P_b^target(i-1) + ΔP_b(i)   （b=π(i)）
P_b^target(i) = P_b^target(i-1)             （b≠π(i)）
force-then-lock 的“锁定”在残差式框架中可写成：对已拧紧螺栓，约束其端面伸长量 Δ_b 保持不变：
Δ_b(u) = mean_up(u·a_b) - mean_dn(u·a_b)
r_lock,b = (Δ_b(u) - Δ_b^locked) / Δ_ref
L_aux 可包含 L_lock = E_b[ r_lock,b^2 ] （对已锁定螺栓开启）
6. 法向接触互补残差 L_cn（不穿透 + 接触压力）
残差式接触通常显式引入法向乘子 λ_n（接触压力）。λ_n 可由网络输出（traction head），也可视为接触点上的可学习/可更新变量。下面给出两种等价且常用的 NCP 形式。
6.1 Fischer-Burmeister（FB）互补函数（推荐）
互补条件：g_n ≥ 0,  λ_n ≥ 0,  g_n·λ_n = 0。FB 函数定义：
φ_FB(a,b) = sqrt(a^2 + b^2 + ε^2) - a - b
r_cn = φ_FB(g_n, λ_n)
L_cn = E_{x∈Γ_c}[ r_cn^2 ]
其中 ε 是数值平滑（例如 1e-8~1e-6）。FB 同时兼顾非负性与互补性，训练通常比 ReLU^2 更稳。
6.2 投影残差（等价的“可行性度量”）
λ_n_proj = max(0, λ_n + κ·(-g_n))    （示例：显式投影/修正）
r_cn = λ_n - λ_n_proj
L_cn = E[ r_cn^2 ]
投影写法更贴近传统接触求解器，但需要选择 κ（类似 penalty）。
7. 切向摩擦残差 L_ct（库仑锥 + 粘滑条件）
切向摩擦需要同时满足：摩擦锥 ||λ_t|| ≤ μ·λ_n，以及 stick/slip 的一致性（率无关）。推荐两种实现：投影残差（工程最稳）与 FB-NCP（理论更统一）。
7.1 投影残差（推荐：与传统数值算法一致）
定义切向相对滑移增量 Δs_t（二维向量），以及试探牵引：
Δs_t = s_t^i - s_t^{i-1}      （若无历史则 Δs_t = s_t）
τ_trial = λ_t + k_t·Δs_t
τ_c = μ · λ_n
τ_proj = Proj_{||τ||≤τ_c}(τ_trial) = τ_trial · min(1, τ_c/(||τ_trial||+δ))
r_ct = τ_trial - τ_proj
L_ct = E[ || r_ct ||^2 ]
解释：当试探牵引超过摩擦锥时，投影会把其拉回锥面；残差 r_ct 衡量违反程度。该形式不需要显式判别 stick/slip，但等价地逼近库仑条件。
7.2 FB-NCP：滑移-屈服互补（可选）
定义屈服函数 y = μλ_n − ||λ_t||，滑移幅值 s = ||Δs_t||，理想库仑摩擦可写成互补：
s ≥ 0,  y ≥ 0,  s·y = 0
r_ct1 = φ_FB(s, y)
此外需要方向一致性（滑移时 λ_t 与 Δs_t 同向/反向）：
if s > 0:   λ_t + μλ_n · (Δs_t/(||Δs_t||+ε)) = 0
r_ct2 = || λ_t + μλ_n·Δs_t/(||Δs_t||+ε) ||
L_ct = E[ r_ct1^2 + r_ct2^2 ]
7.3 关于“完全不用能量”时的关键点：Δs_t 与历史搬运
Δs_t 必须基于阶段 i−1 的参考状态 s_t^{i−1} 计算；否则摩擦会退化为与路径无关。
若阶段间重采样接触点集，应对 s_t^{i−1} 进行“历史场搬运/插值”（最近邻/局部面参数化/形函数投影），避免错配导致发散。
λ_n、λ_t 若不由网络直接输出，也可作为“每接触点状态变量”在 stage 间更新并冻结，这更贴近传统求解器。
8. 正则项 L_reg（防止假振荡/提升可训练性）
纯残差式 PINN 在接触问题中更容易出现高频假解与局部最小，建议加入轻量正则：
L_reg = E_{x∈Ω}[ ||∇u(x)||^2 ]   或   E[ ||∇^2 u||^2 ]（若可计算）
也可使用网络权重 L2： L_reg = ||θ||^2
注意：正则项权重 w_reg 应远小于物理残差主项，以免抹平真实接触局部梯度。
9. 分阶段总损失（拧紧顺序的整体训练目标）
对于分阶段拧紧（stage i=1..S），整体训练目标可取所有阶段损失的加权和：
L_total = Σ_{i=1..S} α_i · L_total(stage i)
常用 α_i 取 1，或对后期阶段加权以突出终态精度。
阶段间的“状态变量”（s_t^{i−1}, λ_n^{i−1}, λ_t^{i−1}, Δ_b^locked 等）应在每个阶段结束后保存，并在下阶段作为参考。
10. 权重与数值调度建议（无能量情况下更关键）
完全舍去能量后，损失项尺度更难自然平衡，建议采用无量纲化 + 逐步加严策略：
10.1 无量纲化建议
应力尺度：σ_ref（例如材料屈服强度或预紧引起的典型应力）。
长度尺度：L_ref（例如结构特征尺寸或接触面尺度）。
力尺度：P_ref（例如最大预紧力或螺栓目标力）。
把 r_const、r_pre、以及牵引/应力相关残差都用 σ_ref/P_ref 归一化，使 w_* 更稳定。
10.2 逐步加严（Continuation）
先训：L_bc + L_tie +（弱）L_eq，使位移场尺度稳定、避免假解。
再加：L_cn（法向互补），先用较大的 ε（FB 平滑）或较小的 κ（投影强度），逐步收紧。
最后加：L_ct（摩擦），先用投影残差或较大 δ（避免除零），并在接触稳定后逐步减小 δ/ε。
对 staged preload：早期减少阶段数或降低 α_i，对后期阶段逐渐加权，避免一开始就训完整序列导致震荡。
附录 A：与现有工程配置的映射（便于落地）
若你当前代码框架沿用 TotalEnergy 的 key 体系，可按如下方式“去能量化”：
将 w_int=0，w_pre=0（不使用 E_int 与 W_pre）；或仅保留极小 w_int 作为数值正则（可选）。
将 w_eq 设为主导（例如 1.0），并确保 L_eq 采用弱式/离散残差实现。
将接触与摩擦改为 L_cn/L_ct 的残差解释（FB 或投影残差），不要在论文中称为势能。
将预紧改为 L_pre（轴向合力残差）与 L_lock（force-then-lock）而不是外功。
若仍输出应力头：保留 w_const（本构一致），可选 w_sigma（监督）用于稳定学习。